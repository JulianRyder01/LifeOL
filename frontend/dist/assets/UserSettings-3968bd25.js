import{A as x,l as C,b as T,d as k,e as I,f as O,h as R,i as A,s as D,k as _,m as U,n as L,o as J,r as m,j as e,p as F,q as G}from"./index-c5f90abf.js";function K(){return{version:x.DATA_FORMAT_VERSION,exportDate:new Date().toISOString(),attributes:C()||T(),events:k()||[],achievements:I()||O(),items:R()||[],projectEvents:A()||[],selectedTitles:JSON.parse(localStorage.getItem(x.STORAGE_KEYS.SELECTED_TITLES)||"[]"),userConfig:JSON.parse(localStorage.getItem(x.STORAGE_KEYS.USER_CONFIG)||"{}")}}function P(s){try{return!s.version||!s.exportDate?(console.error("Invalid data format: missing version or exportDate"),!1):(s.attributes&&D(s.attributes),s.events&&_(s.events),s.achievements&&U(s.achievements),s.items&&L(s.items),s.projectEvents&&J(s.projectEvents),s.selectedTitles&&localStorage.setItem(x.STORAGE_KEYS.SELECTED_TITLES,JSON.stringify(s.selectedTitles)),s.userConfig&&localStorage.setItem(x.STORAGE_KEYS.USER_CONFIG,JSON.stringify(s.userConfig)),!0)}catch(a){return console.error("Error importing user data:",a),!1}}function Y(s="lifeol-export.json"){const a=K(),n=JSON.stringify(a,null,2),c=new Blob([n],{type:"application/json"}),l=URL.createObjectURL(c),t=document.createElement("a");t.href=l,t.download=s,document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(l)},0)}function M(s,a){const n=new FileReader;n.onload=c=>{var l;try{const t=(l=c.target)==null?void 0:l.result;if(!t){a(!1);return}const g=JSON.parse(t),d=P(g);a(d)}catch(t){console.error("Error parsing import file:",t),a(!1)}},n.onerror=()=>{console.error("Error reading file"),a(!1)},n.readAsText(s)}function q({userConfig:s,onUserConfigChange:a,onBack:n}){const[c,l]=m.useState(s.username),[t,g]=m.useState(s.avatar),[d,h]=m.useState(!1),[p,b]=m.useState(!1),[f,o]=m.useState({type:null,message:""});m.useEffect(()=>{const r=localStorage.getItem("lifeol_user_config");if(r){const i=JSON.parse(r);h(i.dontShowTaskCompleteConfirm||!1)}},[]);const v=()=>{const r={username:c,avatar:t};F(r),a(r);const i=localStorage.getItem("lifeol_user_config"),u=i?JSON.parse(i):{};u.dontShowTaskCompleteConfirm=d,localStorage.setItem("lifeol_user_config",JSON.stringify(u)),n()},y=()=>{b(!0)},j=()=>{G()},N=()=>{b(!1)},w=()=>{try{Y(),o({type:"success",message:"数据导出成功！"}),setTimeout(()=>o({type:null,message:""}),3e3)}catch{o({type:"error",message:"数据导出失败，请重试。"}),setTimeout(()=>o({type:null,message:""}),3e3)}},S=r=>{var u;const i=(u=r.target.files)==null?void 0:u[0];i&&(M(i,E=>{E?(o({type:"success",message:"数据导入成功！页面将自动刷新。"}),setTimeout(()=>{o({type:null,message:""}),window.location.reload()},2e3)):(o({type:"error",message:"数据导入失败，请检查文件格式。"}),setTimeout(()=>o({type:null,message:""}),3e3))}),r.target.value="")};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"用户设置"}),e.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),f.type&&e.jsx("div",{className:`mb-4 p-3 rounded ${f.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:f.message}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"基本信息"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"用户名"}),e.jsx("input",{type:"text",value:c,onChange:r=>l(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"头像"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-4xl",children:t}),e.jsx("input",{type:"text",value:t,onChange:r=>g(r.target.value),placeholder:"输入emoji或字符",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]})]})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"系统设置"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"任务完成确认提示"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"进度达到100%时是否显示确认提示"})]}),e.jsx("button",{onClick:()=>h(!d),className:`relative inline-flex h-6 w-11 items-center rounded-full ${d?"bg-blue-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition ${d?"translate-x-6":"translate-x-1"}`})})]})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"数据管理"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"导出数据"}),e.jsxs("label",{className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus-within:ring-2 focus-within:ring-green-500 focus-within:ring-offset-2 text-center cursor-pointer",children:["导入数据",e.jsx("input",{type:"file",accept:".json",onChange:S,className:"hidden"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"导出数据将保存您所有的属性、事件、成就、道具等信息。导入数据将替换当前所有数据，请谨慎操作。"})]})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"关于"}),e.jsx("div",{className:"space-y-4",children:e.jsx("button",{onClick:()=>{},className:"w-full text-left px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"关于开发者"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"危险操作"}),e.jsx("div",{className:"space-y-4",children:e.jsx("button",{onClick:y,className:"w-full text-left px-4 py-2 text-sm text-red-600 bg-red-50 rounded-md hover:bg-red-100",children:"重开人生"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:v,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"保存设置"})})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/3 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"确认重开人生"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"确定要重开人生吗？此操作将清除所有数据，包括属性、事件、成就、道具等。"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:N,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:j,className:"inline-flex items-center px-4 py-2 text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700",children:"确认重开"})]})]})})})]})})}export{q as default};
