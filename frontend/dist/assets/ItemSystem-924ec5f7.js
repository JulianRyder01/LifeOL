import{r as b,j as e}from"./index-ff32a15b.js";const g={int:{name:"智力",icon:"book-open",color:"var(--int-color)"},str:{name:"体魄",icon:"dumbbell",color:"var(--str-color)"},vit:{name:"精力",icon:"battery",color:"var(--vit-color)"},cha:{name:"社交",icon:"users",color:"var(--cha-color)"},eq:{name:"情感",icon:"heart",color:"var(--eq-color)"},cre:{name:"创造",icon:"palette",color:"var(--cre-color)"}};function R({items:y,onAddItem:E,onUseItem:j,onUndoUseItem:v,onUpdateItem:N,attributeNames:A={}}){const[D,p]=b.useState(!1),[r,u]=b.useState(null),[I,m]=b.useState(!1),[l,a]=b.useState(null),[n,d]=b.useState({name:"",description:"",icon:"🎁",type:"consumable",effects:[]}),S={...g,...A},[i,f]=b.useState({attribute:"int",type:"fixed",value:10}),q=()=>{n.name.trim()&&(E(n),d({name:"",description:"",icon:"🎁",type:"consumable",effects:[]}),p(!1))},L=()=>{d({...n,effects:[...n.effects,{...i}]}),f({attribute:"int",type:"fixed",value:10})},M=s=>{const t=[...n.effects];t.splice(s,1),d({...n,effects:t})},w=y.filter(s=>!s.used),k=y.filter(s=>s.used),h=s=>{const t=S[s];return typeof t=="string"?t:(t==null?void 0:t.name)||s},T=()=>{l&&a({...l,effects:[...l.effects||[],{attribute:"int",type:"fixed",value:10}]})},z=s=>{if(l&&l.effects){const t=[...l.effects];t.splice(s,1),a({...l,effects:t})}},F=()=>{if(l&&N){const{id:s,createdAt:t,used:o,...c}=l;N(s,c),m(!1),a(null),u(null)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"道具系统"}),e.jsxs("div",{className:"group relative ml-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border border-gray-400 flex items-center justify-center text-xs text-gray-400 cursor-help",children:"?"}),e.jsxs("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-full mb-2 hidden group-hover:block w-80 bg-gray-800 text-white text-xs rounded py-2 px-3 z-10",children:[e.jsx("p",{children:"道具分为收藏品、消耗品、装备三种。"}),e.jsx("p",{className:"mt-1",children:'收藏品和装备都可以选择"装备上身"、"取消装备"（互斥选择），如果选择装备上身，就可以享受收藏品和装备的增益效果。取消装备，则增益效果消失。'}),e.jsx("p",{className:"mt-1",children:"而消耗品使用才会生效，直接获得增益效果。消耗品在使用后两小时内可以撤销使用。"})]})]})]}),e.jsx("button",{onClick:()=>p(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"添加道具"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"未使用道具"}),w.length===0?e.jsx("p",{className:"text-gray-500",children:"暂无未使用道具"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:w.map(s=>{const t=new Date(s.createdAt),C=Math.abs(new Date().getTime()-t.getTime())/(1e3*60*60)<24;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 text-center hover:shadow-md transition-shadow cursor-pointer",onClick:()=>{u(s),m(!1),a(null)},children:[C&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-orange-500 rounded-full"}),e.jsx("div",{className:"text-3xl mb-2",children:s.icon}),e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${s.type==="equipment"?"bg-blue-100 text-blue-800":s.type==="consumable"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:s.type==="equipment"?"装备":s.type==="consumable"?"消耗品":"收藏品"})}),s.effects&&s.effects.length>0&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:s.effects.map((x,B)=>e.jsxs("div",{children:[h(x.attribute),": ",(x.type==="fixed","+"),x.value,x.type==="percentage"?"%":""]},B))}),s.type==="consumable"&&e.jsx("button",{className:"mt-2 w-full text-xs text-blue-600 hover:text-blue-800",onClick:x=>{x.stopPropagation(),j(s)},children:"使用"})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"已使用道具"}),k.length===0?e.jsx("p",{className:"text-gray-500",children:"暂无已使用道具"}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:k.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 text-center opacity-60",onClick:()=>{u(s),m(!1),a(null)},children:[e.jsx("div",{className:"text-3xl mb-2 grayscale",children:s.icon}),e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${s.type==="equipment"?"bg-blue-100 text-blue-800":s.type==="consumable"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:s.type==="equipment"?"装备":s.type==="consumable"?"消耗品":"收藏品"})}),s.effects&&s.effects.length>0&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:s.effects.map((t,o)=>e.jsxs("div",{children:[h(t.attribute),": ",(t.type==="fixed","+"),t.value,t.type==="percentage"?"%":""]},o))}),s.type==="consumable"&&e.jsx("button",{className:"mt-2 w-full text-xs text-gray-600 hover:text-gray-800",onClick:t=>{t.stopPropagation();const o=new Date(s.usedAt||new Date);if(Math.abs(new Date().getTime()-o.getTime())/(1e3*60*60)>2){alert("超过两小时，无法撤销使用");return}v(s.id)},children:"撤销使用"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"已使用"})]},s.id))})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-10 sm:top-20 mx-auto p-4 sm:p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"添加新道具"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"名称"}),e.jsx("input",{type:"text",value:n.name,onChange:s=>d({...n,name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"描述"}),e.jsx("textarea",{value:n.description,onChange:s=>d({...n,description:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"图标"}),e.jsx("input",{type:"text",value:n.icon,onChange:s=>d({...n,icon:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"输入emoji或字符"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"类型"}),e.jsxs("select",{value:n.type,onChange:s=>d({...n,type:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"equipment",children:"装备"}),e.jsx("option",{value:"consumable",children:"消耗品"}),e.jsx("option",{value:"trophy",children:"收藏品"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"效果"}),e.jsx("button",{type:"button",onClick:L,className:"inline-flex items-center px-2 py-1 border border-transparent text-xs font-medium rounded text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"添加效果"})]}),n.effects.length>0&&e.jsx("div",{className:"border border-gray-200 rounded-md p-3 space-y-2",children:n.effects.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:h(s.attribute)}),e.jsxs("span",{className:"ml-2",children:[(s.type==="fixed","+"),s.value,s.type==="percentage"?"%":" EXP"]})]}),e.jsx("button",{type:"button",onClick:()=>M(t),className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))}),n.effects.length===0&&e.jsx("p",{className:"text-gray-500 text-sm",children:"暂无效果"}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"属性"}),e.jsx("select",{value:i.attribute,onChange:s=>f({...i,attribute:s.target.value}),className:"mt-1 block w-full pl-3 pr-10 py-1 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md",children:Object.entries(g).map(([s,t])=>e.jsx("option",{value:s,children:t.name},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"类型"}),e.jsxs("select",{value:i.type,onChange:s=>f({...i,type:s.target.value}),className:"mt-1 block w-full pl-3 pr-10 py-1 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md",children:[e.jsx("option",{value:"fixed",children:"固定值"}),e.jsx("option",{value:"percentage",children:"百分比"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"数值"}),e.jsx("input",{type:"number",value:i.value,onChange:s=>f({...i,value:parseInt(s.target.value)||0}),className:"mt-1 block w-full px-2 py-1 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md"})]})]})]})]}),e.jsxs("div",{className:"mt-5 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{p(!1),d({name:"",description:"",icon:"🎁",type:"consumable",effects:[]})},className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:q,className:"inline-flex items-center px-4 py-2 text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:"添加"})]})]})})}),r&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-10 sm:top-20 mx-auto p-4 sm:p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"道具详情"}),e.jsx("button",{onClick:()=>{u(null),m(!1),a(null)},className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&e.jsx(e.Fragment,{children:I&&l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"名称"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>a({...l,name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"描述"}),e.jsx("textarea",{value:l.description,onChange:s=>a({...l,description:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"图标"}),e.jsx("input",{type:"text",value:l.icon,onChange:s=>a({...l,icon:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"类型"}),e.jsxs("select",{value:l.type,onChange:s=>a({...l,type:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"equipment",children:"装备"}),e.jsx("option",{value:"consumable",children:"消耗品"}),e.jsx("option",{value:"trophy",children:"收藏品"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"效果"}),e.jsx("button",{type:"button",onClick:T,className:"inline-flex items-center px-2 py-1 border border-transparent text-xs font-medium rounded text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"添加效果"})]}),l.effects&&l.effects.length>0&&e.jsx("div",{className:"border border-gray-200 rounded-md p-3 space-y-2",children:l.effects.map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:s.attribute,onChange:o=>{const c=[...l.effects];c[t].attribute=o.target.value,a({...l,effects:c})},className:"flex-1 px-2 py-1 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded",children:Object.entries(g).map(([o,c])=>e.jsx("option",{value:o,children:c.name},o))}),e.jsxs("select",{value:s.type,onChange:o=>{const c=[...l.effects];c[t].type=o.target.value,a({...l,effects:c})},className:"px-2 py-1 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded",children:[e.jsx("option",{value:"fixed",children:"固定值"}),e.jsx("option",{value:"percentage",children:"百分比"})]}),e.jsx("input",{type:"number",value:s.value,onChange:o=>{const c=[...l.effects];c[t].value=parseInt(o.target.value)||0,a({...l,effects:c})},className:"w-16 px-2 py-1 text-xs border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded"}),e.jsx("button",{type:"button",onClick:()=>z(t),className:"text-red-600 hover:text-red-800",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))}),(!l.effects||l.effects.length===0)&&e.jsx("p",{className:"text-gray-500 text-sm",children:"暂无效果"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{m(!1),a(null)},className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50",children:"取消"}),e.jsx("button",{onClick:F,className:"inline-flex items-center px-4 py-2 text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:"保存"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center text-4xl mb-2",children:r.icon}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:r.name}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium ${r.type==="equipment"?"bg-blue-100 text-blue-800":r.type==="consumable"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:r.type==="equipment"?"装备":r.type==="consumable"?"消耗品":"收藏品"})})]}),r.description&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-1",children:"描述"}),e.jsx("p",{className:"text-gray-600",children:r.description})]}),r.effects&&r.effects.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-2",children:"效果"}),e.jsx("div",{className:"space-y-1",children:r.effects.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:h(s.attribute)}),e.jsxs("span",{className:"font-medium",children:[(s.type==="fixed","+"),s.value,s.type==="percentage"?"%":""]})]},t))})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-1",children:"创建时间"}),e.jsx("p",{className:"text-gray-600",children:new Date(r.createdAt).toLocaleString("zh-CN")})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{a({...r}),m(!0)},className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50",children:"编辑"}),r.type==="consumable"&&!r.used&&e.jsx("button",{onClick:()=>{j(r),u(null)},className:"inline-flex items-center px-4 py-2 text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:"使用"}),r.type==="consumable"&&r.used&&e.jsx("button",{onClick:()=>{v(r.id),u(null)},className:"inline-flex items-center px-4 py-2 text-sm font-medium rounded-md shadow-sm text-white bg-gray-600 hover:bg-gray-700",children:"撤销使用"})]})]})})]})})})]})}export{R as default};
